<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
    <title>CERES</title>
    <link rel="stylesheet" href="bower_components/bootstrap/dist/css/bootstrap.min.css">
    <link href="Content/my-style.css" rel="stylesheet" />
    <link rel="stylesheet" type="text/css" href="Content/styles.css" />
    <link rel="stylesheet" type="text/css" href="Content/w2ui-1.5.min.css" />
</head>
<body>
    <div id="container">
        <div class="myflexbox">
            <div id="" style="height: 45px; width:216px;">
                <div id="">
                    <!--<img style="height: auto; display: block; width: 100%;" src="images/cbps-216.png" />-->
                    <img style="height: auto; display: block; width: 100%;" src="images/cbps_logo.png" />
                </div>
            </div>
            <div id="" class="" style="flex-grow: 1; height: 45px; padding: 0px;">
                <span></span>
            </div>
            <div id="" style="height: 45px; width:300px; padding-top: 10px;">
                <div id="">
                    <img style="height: auto; display: block; width: 100%;" src="images/BI_R204_new.png" />
                </div>
            </div>
        </div>

        <!--<div id="header">
        <div class="bg-image"></div>
    </div>-->

        <div id="banner">
            <section id="section-a">
                <div class="bg-img"></div>
            </section>
        </div>

        <div id="main">
            <div class="bi-banner" style="margin-left:30px;">
                <img src="./images/ceres_banner.png" alt="" />
                <p style="margin-left:-50px;">Please reset your password</p>
            </div>

            <section id="section-b">
                <div id="popupChangePassword1" class="" style="display:block; margin-left: 40px; margin-top: 15px; width: 450px; height: 350px; overflow: hidden; font-size: small;">
                    <div rel="body" style="margin-top: 0px; padding: 10px; line-height: 150%; color: black;">
                        <div class="" style="margin-top: 5px; padding: 10px;">
                            <div class="" style="margin-top: 5px; padding: 10px;">
                                <div class="w2ui-field w2ui-span2">
                                    <label>Old Password:</label>
                                    <div>
                                        <input class="w2ui-input" style="width: 160px; margin-bottom: 0px" id="txtOld" type="password" maxlength="15" size="30" />
                                    </div>
                                </div>
                                <div class="w2ui-field w2ui-span2">
                                    <label>New Password:</label>
                                    <div>
                                        <input class="w2ui-input" style="width: 160px; margin-bottom: 0px" id="txtNew1" type="password" maxlength="15" size="30" />
                                    </div>
                                </div>
                                <div class="w2ui-field w2ui-span2">
                                    <label>Retype Password:</label>
                                    <div>
                                        <input class="w2ui-input" style="width: 160px; margin-bottom: 0px" id="txtNew2" type="password" maxlength="15" size="30" />
                                    </div>
                                </div>
                                <div class="">
                                    <div>
                                        <label id="lblMsg" style="color: red;"></label>
                                    </div>
                                </div>
                            </div>
                            <div rel="buttons" style="margin-left:-60px;">
                                <button class="w2ui-btn w2ui-btn-blue" name="changePassword" onclick="resetPassword()">Change Password</button>
                            </div>
                        </div>
                    </div>

                    <!--<div id="popupChangePassword1" class="" style="display:block; margin-top: 15px; width: 350px; height: 350px; overflow: hidden">
                    <div rel="body" style="margin-top: 0px; padding: 10px; line-height: 150%; color: black;">
                        <div class="" style="margin-top: 5px; padding: 10px;">
                            <div class="w2ui-field w2ui-span2">
                                <label>Old Password:</label>
                                <div>
                                    <input id="txtOld" type="password" maxlength="100" size="60" />
                                </div>
                            </div>
                            <div class="w2ui-field w2ui-span2">
                                <label>New Password:</label>
                                <div>
                                    <input id="txtNew1" type="password" maxlength="100" size="60" />
                                </div>
                            </div>
                            <div class="w2ui-field w2ui-span2">
                                <label>Retype Password:</label>
                                <div>
                                    <input id="txtNew2" type="password" maxlength="100" size="60" />
                                </div>
                            </div>
                            <div class="w2ui-field w2ui-span2">
                                <label></label>
                                <div>
                                    <label id="lblMsg" style="color: red;"></label>
                                </div>
                            </div>
                        </div>

                        <div class="w2ui-buttons">
                            <button class="w2ui-btn w2ui-btn-blue" name="resetPassword" onclick="resetPassword()">Reset Password</button>
                        </div>
                    </div>
                </div>-->
                </div>
            </section>
        </div>

        <div id="main-footer">
            <div class="box">
                Canon DTS - Professional Solutions Division   <br /><br />Having trouble?&nbsp; <br />
                Contact the CBPS Client Support Center at 877-988-2265 or Email: <a href="mailto:CBPS-CSC@cbps.canon.com" target="_blank">CBPS-CSC@cbps.canon.com</a>
                <br />
                © 2021 Canon Business Process Services All rights reserved. Privacy Statement | Terms of Use
                <br />
            </div>
        </div>
    </div>

    <!--<script src="https://ajax.googleapis.com/ajax/libs/jquery/3.5.1/jquery.min.js"></script>
    <script>window.jQuery || document.write(decodeURIComponent('%3Cscript src="js/jquery.min.js"%3E%3C/script%3E'))</script>-->
    <!-- jQuery 3 -->
    <script src="Scripts/jquery.min.js"></script>
    <script type="text/javascript" src="Scripts/w2ui-1.5.min.js"></script>
    <!-- Bootstrap 3.3.7 -->
    <script src="bower_components/bootstrap/dist/js/bootstrap.min.js"></script>

    <script type="text/javascript">
        function resetPassword() {
            //validate
            if ($("#txtOld").val() === "" || $("#txtOld").val() === null) {
                $("#lblMsg").css("color", "red");
                $("#lblMsg")[0].textContent = "Old Password is required";
                return;
            }
            if ($("#txtNew1").val() === "" || $("#txtNew1").val() === null) {
                $("#lblMsg").css("color", "red");
                $("#lblMsg")[0].textContent = "New Password is required";
                return;
            }
            if ($("#txtNew2").val() === "" || $("#txtNew2").val() === null) {
                $("#lblMsg").css("color", "red");
                $("#lblMsg")[0].textContent = "Please retype your Password";
                return;
            }
            if ($("#txtNew1").val() !== $("#txtNew2").val()) {
                $("#lblMsg").css("color", "red");
                $("#lblMsg")[0].textContent = "Passwords do not match";
                return;
            } else {
                $("#lblMsg")[0].textContent = "";
                //enforce password rule
                var decimal = /^(?=.*\d)(?=.*[a-z])(?=.*[A-Z])(?=.*[^a-zA-Z0-9])(?!.*\s).{8,15}$/;
                if (txtNew1.value.match(decimal)) {
                    //reset password
                    $("#lblMsg")[0].textContent = "";
                    var inputData = {
                        "UserName": sessionStorage.getItem("email")
                        , "NewPassword": $("#txtNew1").val()
                        , "OldPassword": $("#txtOld").val()
                    };

                    var sessionToken = sessionStorage.getItem("accessToken");
                    var headerToken = {
                        "Authorization": "Bearer " + sessionToken
                    };

                    $.ajax({
                        url: "api/client/ChangePassword",
                        method: "POST",
                        data: inputData,
                        dataType: "json",
                        headers: headerToken,
                        success: function (data) {
                            if (data === 0) {
                                $("#lblMsg").css("color", "red");
                                $("#lblMsg")[0].textContent = "Username and Password does not match!";
                            } else {
                                $("#lblMsg").css("color", "green");
                                $("#lblMsg")[0].textContent = "Password successfully changed.";
                                var delayInMilliseconds = 2000; //2 seconds
                                setTimeout(function () {
                                    window.location.href = "index3.html";
                                }, delayInMilliseconds);

                                $.ajax({
                                    url: "api/client/UpdateResetFlag",
                                    method: "POST",
                                    //data:
                                    dataType: "json",
                                    headers: headerToken,
                                    success: function (data) {
                                    },
                                    error: handleXHRError
                                });
                            }

                        },
                        error: handleXHRError
                    });
                } else {
                    $("#lblMsg").css("color", "red");
                    $("#lblMsg")[0].textContent = "Password is between 8 to 15 characters having at least one lowercase letter, one uppercase letter, one numeric digit, and one special character";
                }

            }

            function handleXHRError(err) {
                $("#div-signin-loading").hide();
                //$(".div-signin-loading, .div-signin-loading div, .div-signin-loading div img").addClass("hidden").hide();
                toastr.error("Oops! Something went wrong. Please contact BI administrator");
                if ((err.status >= 400 && err.status < 404) || err.status == 500 || err.status == 501) {
                    sessionStorage.clear();
                    window.location.href = "Login3.html";
                }
            }
        }

    </script>

    <script type="text/javascript">
        $(document).ready(function () {

        });
    </script>
</body>
</html >
